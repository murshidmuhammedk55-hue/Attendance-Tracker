<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Attendance Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      padding: 20px;
      color: #000;
      transition: all 0.3s ease;
    }
    h2, h3 {
      text-align: center;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #4CAF50;
      color: white;
    }
    input[type="checkbox"] {
      transform: scale(1.3);
      cursor: pointer;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    .controls {
      margin: 15px 0;
      text-align: center;
    }
    button {
      padding: 8px 16px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      background: #4CAF50;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #45a049;
    }
    #statsTable {
      margin-top: 20px;
      display: none;
    }

    /* ðŸŒ™ Dark Theme */
    body.dark {
      background: #121212;
      color: #e0e0e0;
    }
    body.dark table {
      background: #1e1e1e;
      color: #ddd;
    }
    body.dark th {
      background: #2e7d32;
    }
    body.dark tr:nth-child(even) {
      background: #1a1a1a;
    }
    body.dark button {
      background: #2e7d32;
    }
  </style>
</head>
<body>
  <h2>Attendance Tracker - Semester 1</h2>

  <div class="controls">
    <label for="attendanceDate"><b>Select Date:</b></label>
    <input type="date" id="attendanceDate" onchange="loadTimetable()">
    <button onclick="saveAttendance()">Save Attendance</button>
    <button onclick="toggleTheme()">ðŸŒ™ Toggle Dark Mode</button>
  </div>

  <table id="attendanceTable">
    <thead>
      <tr>
        <th>Period</th>
        <th>Subject</th>
        <th>Present?</th>
      </tr>
    </thead>
    <tbody id="daySchedule"></tbody>
  </table>

  <h3>ðŸ“Š Attendance Statistics</h3>
  <div class="controls">
    <label>From:</label>
    <input type="date" id="fromDate">
    <label>To:</label>
    <input type="date" id="toDate">
    <button onclick="calculateStats()">Calculate Attendance</button>
    <button onclick="clearAll()">Clear All Data</button>
  </div>

  <table id="statsTable">
    <thead>
      <tr>
        <th>Subject</th>
        <th>Attended</th>
        <th>Total</th>
        <th>Percentage</th>
      </tr>
    </thead>
    <tbody id="statsBody"></tbody>
  </table>

  <script>
    // ðŸ“Œ Timetable mapping (Monâ€“Fri)
    const timetable = {
      Monday: [
        ["9:30-10:30", "CHEM"],
        ["10:30-11:30", "ETW"],
        ["11:30-12:30", "BEC"],
        ["1:30-2:30", "CHEM"],
        ["2:30-4:30", "IdeaLab"]
      ],
      Tuesday: [
        ["9:30-10:30", "CHEM"],
        ["10:30-11:30", "M1"],
        ["11:30-12:30", "BE"],
        ["1:30-2:30", "PC"],
        ["2:30-4:30", "LangLab"]
      ],
      Wednesday: [
        ["9:30-10:30", "CHEM"],
        ["10:30-11:30", "M1"],
        ["11:30-12:30", "PC"],
        ["1:30-2:30", "CHEM"],
        ["2:30-4:30", "ECWorkshop"]
      ],
      Thursday: [
        ["9:30-11:30", "CLab"],
        ["11:30-12:30", "M1"],
        ["1:30-2:30", "PC"],
        ["2:30-4:30", "LangLab"]
      ],
      Friday: [
        ["9:30-10:30", "BE"],
        ["10:30-11:30", "CHEM"],
        ["11:30-12:30", "BEC"],
        ["1:30-2:30", "M1"],
        ["2:30-4:30", "EEWorkshop"]
      ]
    };

    // ðŸ“Œ Load timetable for selected date
    // ðŸ“Œ Load timetable for selected date
function loadTimetable() {
  const dateInput = document.getElementById("attendanceDate").value;
  if (!dateInput) return;

  const date = new Date(dateInput);
  const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
  const weekday = days[date.getDay()];

  const tbody = document.getElementById("daySchedule");
  tbody.innerHTML = "";

  if (!timetable[weekday]) {
    tbody.innerHTML = `<tr><td colspan="3">No classes on ${weekday}</td></tr>`;
    return;
  }

  // âœ… Load saved data for this date
  let data = JSON.parse(localStorage.getItem("attendanceData") || "{}");
  let savedDay = data[dateInput] || {};

  timetable[weekday].forEach(([time, subject]) => {
    let subjData = savedDay[subject] || { attended: 0, total: 0 };
    let checked = subjData.attended > 0 ? "checked" : "";
    tbody.innerHTML += `
      <tr>
        <td>${time}</td>
        <td>${subject}</td>
        <td><input type="checkbox" data-subject="${subject}" ${checked}></td>
      </tr>
    `;
  });
}

// ðŸ“Œ Save or Update attendance
function saveAttendance() {
  const date = document.getElementById("attendanceDate").value;
  if (!date) {
    alert("Please select a date!");
    return;
  }

  const checkboxes = document.querySelectorAll("#daySchedule input[type='checkbox']");
  let dayData = {};

  checkboxes.forEach(cb => {
    const subject = cb.dataset.subject;
    if (!dayData[subject]) dayData[subject] = { attended: 0, total: 0 };
    dayData[subject].total++;
    if (cb.checked) dayData[subject].attended++;
  });

  let data = JSON.parse(localStorage.getItem("attendanceData") || "{}");
  data[date] = dayData; // âœ… Overwrites old record if it exists
  localStorage.setItem("attendanceData", JSON.stringify(data));

  alert("Attendance saved/updated for " + date);
}


    // ðŸ“Œ Calculate stats between two dates
    function calculateStats() {
      const from = document.getElementById("fromDate").value;
      const to = document.getElementById("toDate").value;
      if (!from || !to) {
        alert("Please select both dates!");
        return;
      }

      let data = JSON.parse(localStorage.getItem("attendanceData") || "{}");
      let stats = {};

      for (let d in data) {
        if (d >= from && d <= to) {
          let dayData = data[d];
          for (let subj in dayData) {
            if (!stats[subj]) stats[subj] = { attended: 0, total: 0 };
            stats[subj].attended += dayData[subj].attended;
            stats[subj].total += dayData[subj].total;
          }
        }
      }

      const tbody = document.getElementById("statsBody");
      tbody.innerHTML = "";
      for (let subj in stats) {
        const { attended, total } = stats[subj];
        const percent = total ? ((attended / total) * 100).toFixed(2) : "0.00";
        tbody.innerHTML += `<tr>
          <td>${subj}</td>
          <td>${attended}</td>
          <td>${total}</td>
          <td>${percent}%</td>
        </tr>`;
      }

      document.getElementById("statsTable").style.display = "table";
    }

    // ðŸ“Œ Clear all data
    function clearAll() {
      if (confirm("Are you sure you want to clear all attendance data?")) {
        localStorage.removeItem("attendanceData");
        document.getElementById("statsTable").style.display = "none";
        alert("All data cleared.");
      }
    }

    // ðŸŒ™ Dark Mode toggle
    function toggleTheme() {
      document.body.classList.toggle("dark");
    }
  </script>
</body>
</html>
